<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventaris Lab IPA</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-5xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-8">ðŸ“¦ Inventaris Lab IPA</h1>

    <!-- Login -->
    <div id="login-section" class="space-y-4 max-w-sm mx-auto">
      <input id="username" type="text" placeholder="Username" class="w-full px-4 py-2 border rounded" />
      <input id="password" type="password" placeholder="Password" class="w-full px-4 py-2 border rounded" />
      <button onclick="login()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Login</button>
      <p id="login-message" class="text-red-500 text-center"></p>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-section" class="hidden">
      <div class="flex justify-between items-center mt-8">
        <h2 class="text-xl font-semibold">ðŸ“‹ Daftar Inventaris</h2>
        <button onclick="showForm()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">âž• Tambah</button>
      </div>
      <div class="overflow-x-auto mt-4">
        <table class="min-w-full bg-white shadow rounded">
          <thead class="bg-gray-200">
            <tr>
              <th class="p-2 text-left">Nama</th>
              <th class="p-2 text-left">Jumlah</th>
              <th class="p-2 text-left">Satuan</th>
              <th class="p-2 text-left">Kondisi</th>
              <th class="p-2 text-left">Lokasi</th>
              <th class="p-2 text-left">Kategori</th>
              <th class="p-2 text-center">Aksi</th>
            </tr>
          </thead>
          <tbody id="inventaris-table" class="text-sm"></tbody>
        </table>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-10">
      <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h3 id="form-title" class="text-lg font-semibold mb-4">Tambah Barang</h3>
        <input type="text" id="nama" placeholder="Nama Barang" class="w-full mb-2 px-4 py-2 border rounded" />
        <input type="number" id="jumlah" placeholder="Jumlah" class="w-full mb-2 px-4 py-2 border rounded" />
        <input type="text" id="satuan" placeholder="Satuan" class="w-full mb-2 px-4 py-2 border rounded" />
        <input type="text" id="kondisi" placeholder="Kondisi" class="w-full mb-2 px-4 py-2 border rounded" />
        <input type="text" id="lokasi" placeholder="Lokasi" class="w-full mb-2 px-4 py-2 border rounded" />
        <input type="text" id="kategori" placeholder="Kategori" class="w-full mb-2 px-4 py-2 border rounded" />
        <input type="date" id="tanggal" class="w-full mb-2 px-4 py-2 border rounded" />
        <textarea id="catatan" placeholder="Catatan" class="w-full mb-4 px-4 py-2 border rounded"></textarea>
        <input type="hidden" id="edit-id" />
        <div class="flex justify-end space-x-2">
          <button onclick="submitForm()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Simpan</button>
          <button onclick="closeForm()" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Batal</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const URL = "https://script.google.com/macros/s/AKfycbwjK8w-TE-bh7UqYSQ2OohHUoI9G6kfMaSPBBsowjUYmyfvBNG7BHRSHX0Z5fbreUbXWg/exec";
    let loginData = { username: "", password: "" };

    function login() {
      loginData.username = document.getElementById("username").value;
      loginData.password = document.getElementById("password").value;
      document.getElementById("login-message").textContent = "";

      fetch(URL, {
        method: "POST",
        body: new URLSearchParams({
          action: "getInventaris",
          username: loginData.username,
          password: loginData.password
        })
      })
      .then(res => res.json())
      .then(res => {
        if (res.status === "ok") {
          document.getElementById("login-section").classList.add("hidden");
          document.getElementById("dashboard-section").classList.remove("hidden");
          renderTable(res.data);
        } else {
          document.getElementById("login-message").textContent = "Login gagal!";
        }
      });
    }

    function refreshData() {
      fetch(URL, {
        method: "POST",
        body: new URLSearchParams({
          action: "getInventaris",
          username: loginData.username,
          password: loginData.password
        })
      })
      .then(res => res.json())
      .then(res => {
        if (res.status === "ok") renderTable(res.data);
        else alert("Gagal refresh data");
      });
    }

    function renderTable(data) {
      const tbody = document.getElementById("inventaris-table");
      tbody.innerHTML = "";
      data.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="p-2">${item["Nama Barang"]}</td>
          <td class="p-2">${item["Jumlah"]}</td>
          <td class="p-2">${item["Satuan"]}</td>
          <td class="p-2">${item["Kondisi"]}</td>
          <td class="p-2">${item["Lokasi"]}</td>
          <td class="p-2">${item["Kategori"]}</td>
          <td class="p-2 text-center">
            <button onclick='editItem(${JSON.stringify(item)})' class="bg-yellow-400 text-white px-2 py-1 rounded">Edit</button>
            <button onclick='deleteItem("${item.ID}")' class="bg-red-500 text-white px-2 py-1 rounded ml-2">Hapus</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function showForm() {
      document.getElementById("modal").classList.remove("hidden");
      document.getElementById("form-title").textContent = "Tambah Barang";
      document.getElementById("edit-id").value = "";
      document.querySelectorAll('#modal input:not([type=hidden]), #modal textarea').forEach(el => el.value = "");
    }

    function closeForm() {
      document.getElementById("modal").classList.add("hidden");
    }

    function submitForm() {
      const data = {
        "Nama Barang": document.getElementById("nama").value,
        "Jumlah": document.getElementById("jumlah").value,
        "Satuan": document.getElementById("satuan").value,
        "Kondisi": document.getElementById("kondisi").value,
        "Lokasi": document.getElementById("lokasi").value,
        "Kategori": document.getElementById("kategori").value,
        "Tanggal Masuk": document.getElementById("tanggal").value,
        "Catatan": document.getElementById("catatan").value
      };
      const id = document.getElementById("edit-id").value;
      const action = id ? "updateBarang" : "addBarang";

      fetch(URL, {
        method: "POST",
        body: new URLSearchParams({
          action,
          username: loginData.username,
          password: loginData.password,
          ...(id && { id }),
          data: JSON.stringify(data)
        })
      })
      .then(res => res.json())
      .then(res => {
        if (res.status === "ok") {
          closeForm();
          refreshData();
        } else {
          alert("Gagal menyimpan data");
        }
      });
    }

    function editItem(item) {
      showForm();
      document.getElementById("form-title").textContent = "Edit Barang";
      document.getElementById("edit-id").value = item.ID;
      document.getElementById("nama").value = item["Nama Barang"];
      document.getElementById("jumlah").value = item["Jumlah"];
      document.getElementById("satuan").value = item["Satuan"];
      document.getElementById("kondisi").value = item["Kondisi"];
      document.getElementById("lokasi").value = item["Lokasi"];
      document.getElementById("kategori").value = item["Kategori"];
      document.getElementById("tanggal").value = item["Tanggal Masuk"];
      document.getElementById("catatan").value = item["Catatan"];
    }

    function deleteItem(id) {
      if (!confirm("Yakin ingin menghapus barang ini?")) return;
      fetch(URL, {
        method: "POST",
        body: new URLSearchParams({
          action: "deleteBarang",
          username: loginData.username,
          password: loginData.password,
          id
        })
      })
      .then(res => res.json())
      .then(res => {
        if (res.status === "ok") refreshData();
        else alert("Gagal menghapus");
      });
    }
  </script>
</body>
</html>
